package test.net.sourceforge.pmd.rules.design;import test.net.sourceforge.pmd.rules.*;import java.util.List;import java.util.ArrayList;import java.io.InputStream;import junit.framework.TestCase;import net.sourceforge.pmd.*;import net.sourceforge.pmd.renderers.Renderer;import net.sourceforge.pmd.ast.*;import net.sourceforge.pmd.rules.design.*;public class UseSingletonRuleTest    extends RuleTst{    public UseSingletonRuleTest( String name ) {super( name );    }    public void testUseSingleton1() throws Throwable     {Report report = process("design/UseSingleton1.java",new UseSingletonRule());assertEquals( 1, report.size() );    }    public void testUseSingleton2() throws Throwable     {Report report = process("design/UseSingleton2.java",new UseSingletonRule());assertEquals( 0, report.size() );    }    public void testUseSingleton3() throws Throwable     {Report report = process("design/UseSingleton3.java",new UseSingletonRule());assertEquals( 1, report.size() );    }    public void testUseSingleton4() throws Throwable     {Report report = process("design/UseSingleton4.java",new UseSingletonRule());assertEquals( 0, report.size() );    }}
/* * User: tom * Date: Jul 2, 2002 * Time: 11:04:24 AM */package test.net.sourceforge.pmd.rules;import net.sourceforge.pmd.RuleViolation;import net.sourceforge.pmd.Report;import net.sourceforge.pmd.renderers.Renderer;import org.cougaar.util.pmd.DontCreateThreadsRule;public class CreateAThreadRuleTest extends RuleTst {    public CreateAThreadRuleTest(String name) {        super(name);    }    public void testCreateAThread() throws Throwable {        Report report = process("CreatesAThread.java", new DontCreateThreadsRule());        assertEquals(1, report.size());        assertEquals(new DontCreateThreadsRule(), ((RuleViolation)report.iterator().next()).getRule());    }}
package test.net.sourceforge.pmd.rules;import test.net.sourceforge.pmd.*;import net.sourceforge.pmd.*;import net.sourceforge.pmd.rules.LongVariableRule;import net.sourceforge.pmd.renderers.Renderer;import junit.framework.*;public class LongVariableRuleTest    extends RuleTst{    private LongVariableRule rule;    public LongVariableRuleTest( String name ) {super( name );    }    public void setUp() {        rule = new LongVariableRule();        rule.setMessage("Avoid long names like {0}");    }    public void testLongVariableField() throws Throwable {Report report = process("LongVariableField.java",rule );assertEquals( 1, report.size() );    }    public void testLongVariableLocal() throws Throwable {Report report = process("LongVariableLocal.java",rule );assertEquals( 1, report.size() );    }    public void testLongVariableFor() throws Throwable {Report report = process("LongVariableFor.java",rule );assertEquals( 1, report.size() );    }    public void testLongVariableParam() throws Throwable {Report report = process("LongVariableParam.java",rule );assertEquals( 1, report.size() );    }    public void testLongVariableNone() throws Throwable {Report report = process("LongVariableNone.java",rule );assertEquals( 0, report.size() );    }}
/* * User: tom * Date: Jun 28, 2002 * Time: 2:55:48 PM */package test.net.sourceforge.pmd.rules;import net.sourceforge.pmd.renderers.Renderer;import net.sourceforge.pmd.rules.IfElseStmtsMustUseBracesRule;import net.sourceforge.pmd.Report;public class IfElseStmtsMustUseBracesRuleTest extends RuleTst {    public IfElseStmtsMustUseBracesRuleTest(String name) {        super(name);    }    public void testIfElseStmtsMustUseBraces1() throws Throwable {        Report report = process("IfElseStmtsNeedBraces1.java", new IfElseStmtsMustUseBracesRule());        assertEquals(1, report.size());    }    public void testIfElseStmtsMustUseBraces2() throws Throwable {        Report report = process("IfElseStmtsNeedBraces2.java", new IfElseStmtsMustUseBracesRule());        assertTrue(report.isEmpty());    }}
/* * User: tom * Date: Jun 28, 2002 * Time: 1:43:05 PM */package test.net.sourceforge.pmd.rules;import junit.framework.TestCase;import net.sourceforge.pmd.*;import net.sourceforge.pmd.renderers.Renderer;import net.sourceforge.pmd.rules.UnusedLocalVariableRule;import org.cougaar.util.pmd.SystemPropsRule;import java.util.Iterator;import java.util.ArrayList;import java.util.List;import java.io.FileNotFoundException;public class UnusedLocalVariableTest extends RuleTst {    private UnusedLocalVariableRule rule;    public UnusedLocalVariableTest(String name) {        super(name);    }    public void setUp() {        rule = new UnusedLocalVariableRule();        rule.setMessage("Avoid this stuff -> ''{0}''");    }    public void testUnusedLocal1() throws Throwable {        Report report = process("Unused1.java", rule);        assertEquals(1, report.size());        assertEquals(rule, ((RuleViolation)report.iterator().next()).getRule());    }    public void testUnusedLocal2() throws Throwable {        Report report = process("Unused2.java", rule);        assertEquals(1, report.size());        assertEquals(rule, ((RuleViolation)report.iterator().next()).getRule());    }    public void testUnusedLocal3() throws Throwable {        Report report = process("Unused3.java", rule);        assertEquals(1, report.size());        assertEquals(rule, ((RuleViolation)report.iterator().next()).getRule());    }    public void testUnusedLocal4() throws Throwable {        Report report = process("Unused4.java", rule);        assertTrue(report.isEmpty());    }    public void testUnusedLocal5() throws Throwable {        Report report = process("Unused5.java", rule);        assertEquals(1, report.size());        assertEquals(rule, ((RuleViolation)report.iterator().next()).getRule());    }    public void testUnusedLocal6() throws Throwable {        Report report = process("Unused6.java", rule);        assertTrue(report.isEmpty());    }    public void testUnusedLocal7() throws Throwable {        Report report = process("Unused7.java", rule);        assertTrue(report.isEmpty());    }    public void testUnusedLocal8() throws Throwable {        Report report = process("Unused8.java", rule);        assertTrue(report.isEmpty());    }    public void testUnusedLocal9() throws Throwable {        Report report = process("Unused9.java", rule);        assertEquals(2, report.size());        Iterator i =  report.iterator();        assertEquals(rule, ((RuleViolation)i.next()).getRule());        assertEquals(rule, ((RuleViolation)i.next()).getRule());    }    public void testUnusedLocal10() throws Throwable {        Report report = process("Unused10.java", rule);        assertTrue(report.isEmpty());    }}
/* * User: tom * Date: Jul 2, 2002 * Time: 11:05:42 AM */package test.net.sourceforge.pmd.rules;import net.sourceforge.pmd.RuleViolation;import net.sourceforge.pmd.Report;import net.sourceforge.pmd.renderers.Renderer;import org.cougaar.util.pmd.DontCreateTimersRule;public class CreatesATimerTest extends RuleTst {    public CreatesATimerTest(String name) {        super(name);    }    public void testCreateATimer() throws Throwable {        Report report = process("CreatesATimer.java", new DontCreateTimersRule());        assertEquals(1, report.size());        assertEquals(new DontCreateTimersRule(), ((RuleViolation)report.iterator().next()).getRule());    }}
/* * User: tom * Date: Jun 28, 2002 * Time: 2:35:51 PM */package test.net.sourceforge.pmd.rules;import net.sourceforge.pmd.renderers.Renderer;import net.sourceforge.pmd.RuleViolation;import net.sourceforge.pmd.Report;import net.sourceforge.pmd.rules.UnusedPrivateInstanceVariableRule;import net.sourceforge.pmd.rules.UnusedLocalVariableRule;import java.util.Iterator;public class UnusedPrivateInstanceVariableRuleTest extends RuleTst {    private UnusedPrivateInstanceVariableRule rule;    public UnusedPrivateInstanceVariableRuleTest(String name) {        super(name);    }    public void setUp() {        rule = new UnusedPrivateInstanceVariableRule();        rule.setMessage("Avoid this stuff -> ''{0}''");    }    public void testUnusedPrivateInstanceVar1() throws Throwable {        Report report = process("UnusedPrivateInstanceVar1.java", rule);        assertEquals(1, report.size());        Iterator i =  report.iterator();        assertEquals(rule, ((RuleViolation)i.next()).getRule());    }    public void testUnusedPrivateInstanceVar2() throws Throwable {        Report report = process("UnusedPrivateInstanceVar2.java", rule);        assertTrue(report.isEmpty());    }    public void testUnusedPrivateInstanceVar3() throws Throwable {        Report report = process("UnusedPrivateInstanceVar3.java", rule);        assertEquals(1, report.size());        Iterator i =  report.iterator();        assertEquals(rule, ((RuleViolation)i.next()).getRule());    }    public void testUnusedPrivateInstanceVar4() throws Throwable {        Report report = process("UnusedPrivateInstanceVar4.java", rule);        assertTrue(report.isEmpty());    }    public void testUnusedPrivateInstanceVar6() throws Throwable {        Report report = process("UnusedPrivateInstanceVar6.java", rule);        assertTrue(report.isEmpty());    }    public void testUnusedPrivateInstanceVar7() throws Throwable {        Report report = process("UnusedPrivateInstanceVar7.java", rule);        assertTrue(report.isEmpty());    }    public void testUnusedPrivateInstanceVar8() throws Throwable {        Report report = process("UnusedPrivateInstanceVar8.java", rule);        assertTrue(report.isEmpty());    }/*TODO - this tests unused variables in nested classes    public void testUnusedPrivateInstanceVar9() throws Throwable {        Report report = process("UnusedPrivateInstanceVar9.java");        assertEquals(1, report.violationsInCurrentFile());    }TODO - this tests unused variables in nested classes*/}
/* * User: tom * Date: Jul 3, 2002 * Time: 9:40:47 PM */package test.net.sourceforge.pmd.rules;import net.sourceforge.pmd.renderers.Renderer;import net.sourceforge.pmd.rules.EmptyWhileStmtRule;import net.sourceforge.pmd.rules.OverrideBothEqualsAndHashcodeRule;import net.sourceforge.pmd.Report;public class OverrideBothEqualsAndHashcodeRuleTest extends RuleTst {    public OverrideBothEqualsAndHashcodeRuleTest( String name ) {super( name );    }    public void test1() throws Throwable{        Report report = process("OverrideBothEqualsAndHashcode1.java", new OverrideBothEqualsAndHashcodeRule());        assertEquals(1, report.size());    }    public void test2() throws Throwable{        Report report = process("OverrideBothEqualsAndHashcode2.java", new OverrideBothEqualsAndHashcodeRule());        assertEquals(1, report.size());    }    public void test3() throws Throwable{        Report report = process("OverrideBothEqualsAndHashcode3.java", new OverrideBothEqualsAndHashcodeRule());        assertEquals(0, report.size());    }    public void test4() throws Throwable{        Report report = process("OverrideBothEqualsAndHashcode4.java", new OverrideBothEqualsAndHashcodeRule());        assertEquals(0, report.size());    }}
package test.net.sourceforge.pmd.rules;import test.net.sourceforge.pmd.*;import net.sourceforge.pmd.*;import net.sourceforge.pmd.rules.ShortVariableRule;import net.sourceforge.pmd.renderers.Renderer;import junit.framework.*;public class ShortVariableRuleTest    extends RuleTst{    private ShortVariableRule rule;    public ShortVariableRuleTest( String name ) {super( name );    }    public void setUp() {        rule = new ShortVariableRule();        rule.setMessage("Avoid stuff like -> ''{0}''");    }    public void testShortVariableField() throws Throwable {Report report = process("ShortVariableField.java",rule );assertEquals( 1, report.size() );    }    public void testShortVariableLocal() throws Throwable {Report report = process("ShortVariableLocal.java",rule );assertEquals( 1, report.size() );    }    public void testShortVariableFor() throws Throwable {Report report = process("ShortVariableFor.java",rule );assertEquals( 0, report.size() );    }    public void testShortVariableParam() throws Throwable {Report report = process("ShortVariableParam.java",rule );assertEquals( 1, report.size() );    }    public void testShortVariableNone() throws Throwable {Report report = process("ShortVariableNone.java",rule );assertEquals( 0, report.size() );    }}
/* * User: tom * Date: Jul 2, 2002 * Time: 11:03:09 AM */package test.net.sourceforge.pmd.rules;import net.sourceforge.pmd.RuleViolation;import net.sourceforge.pmd.Report;import net.sourceforge.pmd.renderers.Renderer;import org.cougaar.util.pmd.SystemOutRule;public class SystemOutRuleTest extends RuleTst {    public SystemOutRuleTest(String name) {        super(name);    }    public void testSystemOut() throws Throwable {        Report report = process("ContainsSystemOut.java", new SystemOutRule());        assertEquals(1, report.size());        assertEquals(new SystemOutRule(), ((RuleViolation)report.iterator().next()).getRule());    }}
/* * User: tom * Date: Jul 8, 2002 * Time: 3:31:37 PM */package test.net.sourceforge.pmd.rules;import net.sourceforge.pmd.Report;import net.sourceforge.pmd.RuleViolation;import net.sourceforge.pmd.rules.EmptyCatchBlockRule;import net.sourceforge.pmd.rules.EmptyTryBlockRule;public class EmptyTryBlockRuleTest extends RuleTst {    public EmptyTryBlockRuleTest(String name) {        super(name);    }    public void testEmptyTryBlock1() throws Throwable {        Report report = process("EmptyTryBlock1.java", new EmptyTryBlockRule());        assertEquals(1, report.size());        assertEquals(new EmptyTryBlockRule(), ((RuleViolation)report.iterator().next()).getRule());    }    public void testEmptyTryBlock2() throws Throwable {        Report report = process("EmptyTryBlock2.java", new EmptyTryBlockRule());        assertEquals(1, report.size());        assertEquals(new EmptyTryBlockRule(), ((RuleViolation)report.iterator().next()).getRule());    }    public void testEmptyTryBlock3() throws Throwable {        Report report = process("EmptyTryBlock3.java", new EmptyTryBlockRule());        assertTrue(report.isEmpty());    }}
/* * User: tom * Date: Jun 28, 2002 * Time: 2:34:20 PM */package test.net.sourceforge.pmd.rules;import junit.framework.TestCase;import net.sourceforge.pmd.renderers.Renderer;import net.sourceforge.pmd.RuleViolation;import net.sourceforge.pmd.Report;import net.sourceforge.pmd.rules.UnnecessaryConversionTemporaryRule;public class UnnecessaryTemporariesRuleTest extends RuleTst{    public UnnecessaryTemporariesRuleTest(String name) {        super(name);    }    public void testUnnecessaryTemporaries() throws Throwable {        Report report = process("UnnecessaryTemporary.java", new UnnecessaryConversionTemporaryRule());        assertEquals(6, report.size());        assertEquals(new UnnecessaryConversionTemporaryRule(), ((RuleViolation)report.iterator().next()).getRule());    }}
package test.net.sourceforge.pmd.rules;import test.net.sourceforge.pmd.*;import net.sourceforge.pmd.*;import net.sourceforge.pmd.rules.ShortMethodNameRule;import net.sourceforge.pmd.renderers.Renderer;import junit.framework.*;public class ShortMethodNameRuleTest    extends RuleTst{    private ShortMethodNameRule rule;    public ShortMethodNameRuleTest( String name ) {super( name );    }    public void setUp() {        rule = new ShortMethodNameRule();        rule.setMessage("Avoid this stuff -> {0}");    }    public void testShortMethodName0() throws Throwable {Report report = process("ShortMethodName0.java",rule );assertEquals( 0, report.size() );    }    public void testShortMethodName1() throws Throwable {Report report = process("ShortMethodName1.java",rule );assertEquals( 1, report.size() );    }    public void testShortMethodName2() throws Throwable {Report report = process("ShortMethodName2.java",rule );assertEquals( 2, report.size() );    }    public void testShortMethodName3() throws Throwable {Report report = process("ShortMethodName3.java",rule );assertEquals( 1, report.size() );    }}
/* * User: tom * Date: Jun 28, 2002 * Time: 1:56:19 PM */package test.net.sourceforge.pmd.rules;import junit.framework.TestCase;import net.sourceforge.pmd.renderers.Renderer;import net.sourceforge.pmd.RuleViolation;import net.sourceforge.pmd.Report;import net.sourceforge.pmd.rules.EmptyCatchBlockRule;public class EmptyCatchBlockRuleTest extends RuleTst {    public EmptyCatchBlockRuleTest(String name) {        super(name);    }    public void testEmptyCatchBlock() throws Throwable {        Report report = process("EmptyCatchBlock.java", new EmptyCatchBlockRule());        assertEquals(1, report.size());        assertEquals(new EmptyCatchBlockRule(), ((RuleViolation)report.iterator().next()).getRule());    }    public void testEmptyCatchBlock2() throws Throwable {        Report report = process("EmptyCatchBlock2.java", new EmptyCatchBlockRule());        assertTrue(report.isEmpty());    }    public void testEmptyCatchBlock3() throws Throwable {        Report report = process("EmptyCatchBlock3.java", new EmptyCatchBlockRule());        assertEquals(1, report.size());        assertEquals(new EmptyCatchBlockRule(), ((RuleViolation)report.iterator().next()).getRule());    }}
/* * User: tom * Date: Jul 2, 2002 * Time: 11:08:40 AM */package test.net.sourceforge.pmd.rules;import net.sourceforge.pmd.RuleViolation;import net.sourceforge.pmd.Report;import net.sourceforge.pmd.renderers.Renderer;import net.sourceforge.pmd.rules.EmptyWhileStmtRule;public class EmptyWhileStmtRuleTest extends RuleTst {    public EmptyWhileStmtRuleTest(String name) {        super(name);    }    public void testEmptyWhileStmtRule() throws Throwable {        Report report = process("EmptyWhileStmtRule.java", new EmptyWhileStmtRule());        assertEquals(1, report.size());        assertEquals(new EmptyWhileStmtRule(), ((RuleViolation)report.iterator().next()).getRule());    }}
/* * User: tom * Date: Jul 2, 2002 * Time: 11:00:43 AM */package test.net.sourceforge.pmd.rules;import net.sourceforge.pmd.RuleViolation;import net.sourceforge.pmd.Report;import net.sourceforge.pmd.renderers.Renderer;import org.cougaar.util.pmd.SystemOutRule;public class SystemInRuleTest extends RuleTst {    public SystemInRuleTest(String name) {        super(name);    }    public void testSystemIn() throws Throwable {        Report report = process("ContainsSystemIn.java", new SystemOutRule());        assertEquals(2, report.size());        assertEquals(new SystemOutRule(), ((RuleViolation)report.iterator().next()).getRule());    }}
/* * User: tom * Date: Jul 2, 2002 * Time: 11:07:25 AM */package test.net.sourceforge.pmd.rules;import net.sourceforge.pmd.RuleViolation;import net.sourceforge.pmd.Report;import net.sourceforge.pmd.renderers.Renderer;import net.sourceforge.pmd.rules.EmptyIfStmtRule;public class EmptyIfStmtRuleTest extends RuleTst {    public EmptyIfStmtRuleTest(String name) {        super(name);    }    public void testEmptyIf() throws Throwable {        Report report = process("EmptyIfStmtRule.java", new EmptyIfStmtRule());        assertEquals(1, report.size());        assertEquals(new EmptyIfStmtRule(), ((RuleViolation)report.iterator().next()).getRule());    }}
/* * User: tom * Date: Jul 10, 2002 * Time: 3:22:57 PM */package test.net.sourceforge.pmd.rules;import net.sourceforge.pmd.Report;import net.sourceforge.pmd.RuleViolation;import net.sourceforge.pmd.rules.EmptyFinallyBlockRule;public class EmptyFinallyBlockRuleTest extends RuleTst {    public EmptyFinallyBlockRuleTest(String name) {        super(name);    }    public void testEmptyFinallyBlock1() throws Throwable {        Report report = process("EmptyFinallyBlock1.java", new EmptyFinallyBlockRule());        assertEquals(1, report.size());        assertEquals(new EmptyFinallyBlockRule(), ((RuleViolation)report.iterator().next()).getRule());    }    public void testEmptyFinallyBlock2() throws Throwable {        Report report = process("EmptyFinallyBlock2.java", new EmptyFinallyBlockRule());        assertEquals(1, report.size());        assertEquals(new EmptyFinallyBlockRule(), ((RuleViolation)report.iterator().next()).getRule());    }    public void testEmptyFinallyBlock3() throws Throwable {        Report report = process("EmptyFinallyBlock3.java", new EmptyFinallyBlockRule());        assertTrue(report.isEmpty());    }}
/* * User: tom * Date: Jul 2, 2002 * Time: 10:58:49 AM */package test.net.sourceforge.pmd.rules;import junit.framework.TestCase;import net.sourceforge.pmd.RuleViolation;import net.sourceforge.pmd.Report;import net.sourceforge.pmd.renderers.Renderer;import org.cougaar.util.pmd.SystemPropsRule;public class SystemPropsRuleTest extends RuleTst {    public SystemPropsRuleTest(String name) {        super(name);    }    public void testProps() throws Throwable {        Report report = process("ContainsSystemGetProps.java", new SystemPropsRule());        assertEquals(3, report.size());        assertEquals(new SystemPropsRule(), ((RuleViolation)report.iterator().next()).getRule());    }    public void testProps2() throws Throwable {        Report report = process("ContainsSystemGetProps2.java", new SystemPropsRule());        assertTrue(report.isEmpty());    }}
package test.net.sourceforge.pmd.renderers;import junit.framework.TestCase;import java.util.List;import java.util.Iterator;import java.util.ArrayList;import test.net.sourceforge.pmd.MockRule;import net.sourceforge.pmd.renderers.*;import net.sourceforge.pmd.*;public class XMLRendererTest    extends TestCase{    private XMLRenderer IUT = null;    private MockRule RULE1 = new MockRule( "RULE1", "RULE1" );    private MockRule RULE2 = new MockRule( "RULE2", "RULE2" );    public XMLRendererTest( String name ) {super( name );    }    public void setUp() {IUT = new XMLRenderer();    }    public void testEmptyReport() throws Throwable    {String rendered = IUT.render( new Report() );assertTrue("Expected empty PMD tag.",   rendered.indexOf("violation") < 0);    }    public void testSingleReport() throws Throwable    {Report report = new Report();report.addRuleViolation( new RuleViolation( RULE1,  1, "Rule1", "testSingleReport") );String rendered = IUT.render( report );// <?xml version="1.0"?>// <pmd>//   <file name="testSingleReport">//     <violation line="1" rule="RULE1">        // Rule1        //     </violation>        //   </file>        // </pmd>List expectedStrings = new ArrayList();expectedStrings.add("<pmd>");expectedStrings.add("<file name=\"testSingleReport\">" );expectedStrings.add("<violation line=\"1\" rule=\"RULE1\">");expectedStrings.add("Rule1");expectedStrings.add("</violation>");expectedStrings.add("</file>");expectedStrings.add("</pmd>");verifyPositions( rendered, expectedStrings );    }    public void testDoubleReport() throws Throwable    {Report report = new Report();report.addRuleViolation( new RuleViolation( RULE1,  1, "Rule1", "testDoubleReport") );report.addRuleViolation( new RuleViolation( RULE2,  2, "Rule2", "testDoubleReport") );String rendered = IUT.render( report );// <?xml version="1.0"?>// <pmd>//   <file name="testSingleReport">//     <violation line="1" rule="RULE1">        // Rule1        //     </violation>//     <violation line="2" rule="RULE2">// Rule2//     </violation>        //   </file>        // </pmd>List expectedStrings = new ArrayList();expectedStrings.add("<pmd>");expectedStrings.add("<file name=\"testDoubleReport\">" );expectedStrings.add("<violation line=\"1\" rule=\"RULE1\">");expectedStrings.add("Rule1");expectedStrings.add("</violation>");expectedStrings.add("<violation line=\"2\" rule=\"RULE2\">");expectedStrings.add("Rule2");expectedStrings.add("</violation>");expectedStrings.add("</file>");expectedStrings.add("</pmd>");verifyPositions( rendered, expectedStrings );    }    public void testTwoFiles() throws Throwable    {Report report = new Report();report.addRuleViolation( new RuleViolation( RULE1,  1, "Rule1", "testTwoFiles_0") );report.addRuleViolation( new RuleViolation( RULE1,  1, "Rule1", "testTwoFiles_1") );String rendered = IUT.render( report );// <?xml version="1.0"?>// <pmd>//   <file name="testTwoFiles_0">//     <violation line="1" rule="RULE1">        // Rule1        //     </violation>//   </file>//   <file name="testTwoFiles_1">//     <violation line="1" rule="RULE1">// Rule1//     </violation>        //   </file>        // </pmd>List expectedStrings = new ArrayList();expectedStrings.add("<pmd>");expectedStrings.add("<file name=\"testTwoFiles_0\">" );expectedStrings.add("<violation line=\"1\" rule=\"RULE1\">");expectedStrings.add("Rule1");expectedStrings.add("</violation>");expectedStrings.add("</file>");expectedStrings.add("<file name=\"testTwoFiles_1\">" );expectedStrings.add("<violation line=\"1\" rule=\"RULE1\">");expectedStrings.add("Rule1");expectedStrings.add("</violation>");expectedStrings.add("</file>");expectedStrings.add("</pmd>");verifyPositions( rendered, expectedStrings );    }    public void testUnorderedFiles() throws Throwable    {Report report = new Report();report.addRuleViolation( new RuleViolation( RULE1,  1, "Rule1", "testTwoFiles_0") );report.addRuleViolation( new RuleViolation( RULE1,  1, "Rule1", "testTwoFiles_1") );report.addRuleViolation( new RuleViolation( RULE2,  2, "Rule2", "testTwoFiles_0") );String rendered = IUT.render( report );// <?xml version="1.0"?>// <pmd>//   <file name="testTwoFiles_0">//     <violation line="1" rule="RULE1">        // Rule1        //     </violation>//   </file>//   <file name="testTwoFiles_1">//     <violation line="1" rule="RULE1">// Rule1//     </violation>        //   </file>        // </pmd>System.err.println( rendered );List expectedStrings = new ArrayList();expectedStrings.add("<pmd>");expectedStrings.add("<file name=\"testTwoFiles_0\">" );expectedStrings.add("<violation line=\"1\" rule=\"RULE1\">");expectedStrings.add("Rule1");expectedStrings.add("</violation>");expectedStrings.add("<violation line=\"2\" rule=\"RULE2\">");expectedStrings.add("Rule2");expectedStrings.add("</violation>");expectedStrings.add("</file>");expectedStrings.add("<file name=\"testTwoFiles_1\">" );expectedStrings.add("<violation line=\"1\" rule=\"RULE1\">");expectedStrings.add("Rule1");expectedStrings.add("</violation>");expectedStrings.add("</file>");expectedStrings.add("</pmd>");verifyPositions( rendered, expectedStrings );    }    public void verifyPositions( String rendered,  List strings ) {Iterator i = strings.iterator();int currPos = 0;String lastString = "<?xml version=\"1.0\"?>";while (i.hasNext()) {    String str = (String) i.next();    int strPos = rendered.indexOf( str, currPos );    assertTrue("Expecting: " + str + " after " + lastString,       strPos > currPos );    currPos = strPos;    lastString = str;}    }}
package test.net.sourceforge.pmd.ast;import java.util.Set;import java.util.Iterator;import net.sourceforge.pmd.ast.*;public class FieldDeclTest    extends ParserTst{    public FieldDeclTest( String name ) {super( name );    }    public String makeAccessJavaCode( String access[] ) {String RC =     "public class Test { ";for (int i = 0; i < access.length; i++) {    RC += access[i] + " ";}RC += " int j;  }";return RC;    }    public ASTFieldDeclaration getFieldDecl( String access[] )throws Throwable    {Set fields = getNodes( ASTFieldDeclaration.class,       makeAccessJavaCode( access ) );assertEquals( "Wrong number of fields",      1, fields.size());Iterator i = fields.iterator();return (ASTFieldDeclaration) i.next();    }    public void testPublic() throws Throwable    {String access[] = { "public" };ASTFieldDeclaration afd = getFieldDecl( access );assertTrue( "Expecting field to be public.",    afd.isPublic() );    }    public void testProtected() throws Throwable    {String access[] = { "protected" };ASTFieldDeclaration afd = getFieldDecl( access );assertTrue( "Expecting field to be protected.",    afd.isProtected() );    }    public void testPrivate() throws Throwable    {String access[] = { "private" };ASTFieldDeclaration afd = getFieldDecl( access );assertTrue( "Expecting field to be private.",    afd.isPrivate() );    }    public void testStatic() throws Throwable    {String access[] = { "private", "static" };ASTFieldDeclaration afd = getFieldDecl( access );assertTrue( "Expecting field to be static.",    afd.isStatic() );assertTrue( "Expecting field to be private.",    afd.isPrivate() );    }    public void testFinal() throws Throwable    {String access[] = { "public", "final" };ASTFieldDeclaration afd = getFieldDecl( access );assertTrue( "Expecting field to be final.",    afd.isFinal() );assertTrue( "Expecting field to be public.",    afd.isPublic() );    }    public void testTransient() throws Throwable    {String access[] = { "private", "transient" };ASTFieldDeclaration afd = getFieldDecl( access );assertTrue( "Expecting field to be private.",    afd.isPrivate() );assertTrue( "Expecting field to be transient.",    afd.isTransient() );    }    public void testVolatile() throws Throwable    {String access[] = { "private", "volatile" };ASTFieldDeclaration afd = getFieldDecl( access );assertTrue( "Expecting field to be volatile.",    afd.isVolatile() );assertTrue( "Expecting field to be private.",    afd.isPrivate() );    }}
package test.net.sourceforge.pmd.ast;import java.io.StringReader;import java.util.Set;import java.util.HashSet;import java.util.Map;import java.util.HashMap;import java.util.Iterator;import net.sourceforge.pmd.ast.*;public class MethodDeclTest    extends ParserTst{    public MethodDeclTest( String name ) {super( name );    }    public void testPublic() throws Throwable    {String access[] = { "public" };ASTMethodDeclaration amd = getMethodDecl( access );assertTrue( "Expecting method to be public.",    amd.isPublic() );    }    public void testPrivate() throws Throwable    {String access[] = { "private" };ASTMethodDeclaration amd = getMethodDecl( access );assertTrue( "Expecting method to be private.",    amd.isPrivate() );    }    public void testProtected() throws Throwable    {String access[] = { "protected" };ASTMethodDeclaration amd = getMethodDecl( access );assertTrue( "Expecting method to be protected.",    amd.isProtected() );    }    public void testFinal() throws Throwable    {String access[] = { "public", "final" };ASTMethodDeclaration amd = getMethodDecl( access );assertTrue( "Expecting method to be final.",    amd.isFinal() );assertTrue( "Expecting method to be public.",    amd.isPublic() );    }    public void testSynchronized() throws Throwable    {String access[] = { "public", "synchronized" };ASTMethodDeclaration amd = getMethodDecl( access );assertTrue( "Expecting method to be synchronized.",    amd.isSynchronized() );assertTrue( "Expecting method to be public.",    amd.isPublic() );    }    public void testAbstract() throws Throwable    {String access[] = { "public", "abstract" };ASTMethodDeclaration amd = getMethodDecl( access );assertTrue( "Expecting method to be abstract.",    amd.isAbstract() );assertTrue( "Expecting method to be public.",    amd.isPublic() );    }    public void testNative() throws Throwable    {String access[] = { "private", "native" };ASTMethodDeclaration amd = getMethodDecl( access );assertTrue( "Expecting method to be native.",    amd.isNative() );assertTrue( "Expecting method to be private.",    amd.isPrivate() );    }    public void testStrict() throws Throwable    {String access[] = { "public", "strictfp" };ASTMethodDeclaration amd = getMethodDecl( access );assertTrue( "Expecting method to be strict.",    amd.isStrict() );assertTrue( "Expecting method to be public.",    amd.isPublic() );    }    public ASTMethodDeclaration getMethodDecl( String access[] )throws Throwable    {String javaCode =    "public class Test { ";for (int i = 0; i < access.length; i++) {    javaCode += access[i] + " ";} javaCode +=    " void stuff() { } }";Set methods = getNodes( ASTMethodDeclaration.class,javaCode );assertEquals( "Wrong number of methods",      1, methods.size());Iterator i = methods.iterator();return (ASTMethodDeclaration) i.next();    }}
package test.net.sourceforge.pmd.ast;import net.sourceforge.pmd.ast.*;import junit.framework.*;public class AccessNodeTest    extends TestCase{    public AccessNodeTest( String name ) { super( name ); }    public void testStatic() {AccessNode node = new AccessNode( 1 );assertTrue( "Node should default to not static.",     !node.isStatic());node.setStatic(true);assertTrue( "Node set to static, not static.",     node.isStatic() );node.setStatic(false);assertTrue( "Node set to not static, is static.",     !node.isStatic());    }    public void testPublic() {AccessNode node = new AccessNode( 1 );assertTrue( "Node should default to not public.",    !node.isPublic());node.setPublic(true);assertTrue( "Node set to public, not public.",    node.isPublic());node.setPublic(false);assertTrue( "Node set to not public, is public.",     !node.isPublic());    }    public void testProtected() {AccessNode node = new AccessNode( 1 );assertTrue( "Node should default to not protected.",    !node.isProtected());node.setProtected(true);assertTrue( "Node set to protected, not protected.",     node.isProtected());node.setProtected(false);assertTrue( "Node set to not protected, is protected.",    !node.isProtected());    }    public void testPrivate() {AccessNode node = new AccessNode( 1 );assertTrue( "Node should default to not private.",    !node.isPrivate());node.setPrivate(true);assertTrue( "Node set to private, not private.",    node.isPrivate());node.setPrivate(false);assertTrue( "Node set to not private, is private.",    !node.isPrivate());    }    public void testFinal() {AccessNode node = new AccessNode( 1 );assertTrue( "Node should default to not final.",    !node.isFinal());node.setFinal(true);assertTrue( "Node set to final, not final.",    node.isFinal());node.setFinal(false);assertTrue( "Node set to not final, is final.",    !node.isFinal());    }    public void testSynchronized() {AccessNode node = new AccessNode( 1 );assertTrue( "Node should default to not synchronized.",    !node.isSynchronized());node.setSynchronized(true);assertTrue( "Node set to synchronized, not synchronized.",    node.isSynchronized());node.setSynchronized(false);assertTrue( "Node set to not synchronized, is synchronized.",    !node.isSynchronized());    }    public void testVolatile() {AccessNode node = new AccessNode( 1 );assertTrue( "Node should default to not volatile.",    !node.isVolatile());node.setVolatile(true);assertTrue( "Node set to volatile, not volatile.",    node.isVolatile());node.setVolatile(false);assertTrue( "Node set to not volatile, is volatile.",    !node.isVolatile());    }    public void testTransient() {AccessNode node = new AccessNode( 1 );assertTrue("Node should default to not transient.",   !node.isTransient());node.setTransient(true);assertTrue( "Node set to transient, not transient.",    node.isTransient());node.setTransient(false);assertTrue( "Node set to not transient, is transient.",    !node.isTransient());    }    public void testNative() {AccessNode node = new AccessNode( 1 );assertTrue( "Node should default to not native.",    !node.isNative());node.setNative(true);assertTrue( "Node set to native, not native.",    node.isNative());node.setNative(false);assertTrue( "Node set to not native, is native.",    !node.isNative());    }    public void testInterface() {AccessNode node = new AccessNode( 1 );assertTrue( "Node should default to not interface.",    !node.isInterface());node.setInterface(true);assertTrue( "Node set to interface, not interface.",    node.isInterface());node.setInterface(false);assertTrue( "Node set to not interface, is interface.",    !node.isInterface());    }    public void testAbstract() {AccessNode node = new AccessNode( 1 );assertTrue( "Node should default to not abstract.",    !node.isAbstract());node.setAbstract(true);assertTrue( "Node set to abstract, not abstract.",    node.isAbstract());node.setAbstract(false);assertTrue( "Node set to not abstract, is abstract.",    !node.isAbstract());    }    public void testStrict() {AccessNode node = new AccessNode( 1 );assertTrue( "Node should default to not strict.",    !node.isStrict());node.setStrict(true);assertTrue( "Node set to strict, not strict.",    node.isStrict());node.setStrict(false);assertTrue( "Node set to not strict, is strict.",    !node.isStrict());    }    public void testSuper() {AccessNode node = new AccessNode( 1 );assertTrue( "Node should default to not super.",    !node.isSuper());node.setSuper(true);assertTrue( "Node set to super, not super.",    node.isSuper());node.setSuper(false);assertTrue( "Node set to not super, is super.",    !node.isSuper());    }}
/* * User: tom * Date: Jul 9, 2002 * Time: 2:52:26 PM */package test.net.sourceforge.pmd;import junit.framework.TestCase;import net.sourceforge.pmd.ExternalRuleID;public class ExternalRuleIDTest extends TestCase{    public ExternalRuleIDTest(String name) {        super(name);    }    public void testParse() {        String xrefString = "rulesets/basic.xml/EmptyCatchBlock";        ExternalRuleID xref = new ExternalRuleID(xrefString);        assertEquals("rulesets/basic.xml", xref.getFilename());        assertEquals("EmptyCatchBlock", xref.getRuleName());    }}
/* * User: tom * Date: Jun 19, 2002 * Time: 11:09:06 AM */package test.net.sourceforge.pmd;import junit.framework.TestCase;import net.sourceforge.pmd.SymbolTable;import net.sourceforge.pmd.Symbol;import java.util.HashMap;public class SymbolTableTest extends TestCase {    private static final Symbol FOO = new Symbol("foo", 10);    public SymbolTableTest(String name) {        super(name);    }    public void testAdd() {        SymbolTable s = new SymbolTable();        s.add(FOO);        try {            s.add(FOO);        } catch (RuntimeException e) {            return; // cool        }        throw new RuntimeException("Should have thrown RuntimeException");    }    public void testParent() {        SymbolTable parent = new SymbolTable();        SymbolTable child = new SymbolTable(parent);        assertEquals(child.getParent(), parent);    }    public void testAddSameSymbol() {        SymbolTable parent = new SymbolTable();        parent.add(FOO);        SymbolTable child = new SymbolTable(parent);        try {            child.add(FOO);        } catch (RuntimeException e) {            return; // cool        }        throw new RuntimeException("Should have thrown RuntimeException");    }    public void testParentContains2() {        SymbolTable parent = new SymbolTable();        SymbolTable child = new SymbolTable(parent);        child.add(new Symbol("bar", 12));        child.add(new Symbol("baz", 12));        assertTrue(!parent.getUnusedSymbols().hasNext());        assertTrue(child.getUnusedSymbols().hasNext());    }    public void testRecordUsage() {        SymbolTable s = new SymbolTable();        s.add(FOO);        assertTrue(s.getUnusedSymbols().hasNext());        s.recordPossibleUsageOf(FOO);        assertTrue(!s.getUnusedSymbols().hasNext());    }    public void testRecordPossibleUsage() {        SymbolTable parent = new SymbolTable();        SymbolTable child = new SymbolTable(parent);        child.recordPossibleUsageOf(new Symbol("bar", 10));        assertTrue(!parent.getUnusedSymbols().hasNext());    }    public void testRecordPossibleUsage2() {        SymbolTable s = new SymbolTable();        s.recordPossibleUsageOf(new Symbol("bar", 10));        assertTrue(!s.getUnusedSymbols().hasNext());    }    public void testRecordUsageParent() {        SymbolTable parent = new SymbolTable();        parent.add(FOO);        SymbolTable child = new SymbolTable(parent);        assertEquals(FOO, parent.getUnusedSymbols().next());    }    public void testRecordUsageParent2() {        SymbolTable parent = new SymbolTable();        parent.add(FOO);        SymbolTable child = new SymbolTable(parent);        child.recordPossibleUsageOf(FOO);        assertTrue(!parent.getUnusedSymbols().hasNext());    }}
/* * User: tom * Date: Jul 1, 2002 * Time: 1:16:07 PM */package test.net.sourceforge.pmd;import junit.framework.TestCase;import net.sourceforge.pmd.AbstractRule;import net.sourceforge.pmd.RuleViolation;import net.sourceforge.pmd.RuleContext;public class AbstractRuleTest extends TestCase {    private static class MyRule extends AbstractRule {        public String getMessage() {            return "myrule";        }    }    public  AbstractRuleTest(String name) {        super(name);    }    public void testCreateRV() {        MyRule r = new MyRule();        RuleContext ctx = new RuleContext();        ctx.setSourceCodeFilename("filename");        RuleViolation rv = r.createRuleViolation(ctx, 5);        assertEquals(5, rv.getLine());        assertEquals("filename", rv.getFilename());        assertEquals(r, rv.getRule());        assertEquals("myrule", rv.getDescription());    }    public void testCreateRV2() {        MyRule r = new MyRule();        RuleContext ctx = new RuleContext();        ctx.setSourceCodeFilename("filename");        RuleViolation rv = r.createRuleViolation(ctx, 5, "specificdescription");        assertEquals(5, rv.getLine());        assertEquals("filename", rv.getFilename());        assertEquals(r, rv.getRule());        assertEquals("specificdescription", rv.getDescription());    }}
package test.net.sourceforge.pmd;import net.sourceforge.pmd.*;import net.sourceforge.pmd.renderers.Renderer;import net.sourceforge.pmd.ast.*;import java.io.StringReader;import java.util.Set;import java.util.List;import java.util.Random;import java.util.HashSet;import java.util.Iterator;import java.util.ArrayList;import java.util.Collections;import junit.framework.*;public class RuleSetTest extends TestCase{    private String javaCode ="public class Test { }";    public RuleSetTest( String name ) {super( name );    }    public void testConstructor() {RuleSet IUT = new RuleSet();    }    public void testGetRuleByName() {        RuleSet rs = new RuleSet();        MockRule mock = new MockRule("name", "desc");        rs.addRule(mock);        assertEquals(mock, rs.getRuleByName("name"));    }    public void testRuleList() {RuleSet IUT = new RuleSet();assertEquals( "Size of RuleSet isn't zero.",      0, IUT.size() );MockRule rule = new MockRule();IUT.addRule( rule );assertEquals( "Size of RuleSet isn't one.",      1, IUT.size() );Set rules = IUT.getRules();Iterator i = rules.iterator();assertTrue( "Empty Set",    i.hasNext());assertEquals( "Returned set of wrong size.",      1, rules.size() );assertEquals( "Rule isn't in ruleset.",      rule, i.next() );    }    public void testAddRuleSet() {        RuleSet set1 = new RuleSet();        set1.addRule(new MockRule());        RuleSet set2 = new RuleSet();        set2.addRule(new MockRule());        set1.addRuleSet(set2);        assertEquals(2, set1.size());    }    public void testApply0Rules()throws Throwable    {RuleSet IUT = new RuleSet();verifyRuleSet( IUT, 0, new HashSet() );    }    public void testApply1Rule()throws Throwable    {RuleSet IUT = new RuleSet();MockRule rule = new MockRule();RuleViolation violation = new RuleViolation( rule, 1, "filename" );rule.addViolation( violation );IUT.addRule( rule );verifyRuleSet( IUT, 1, Collections.singleton( violation ) );    }    public void testApplyNRule() throws Throwable    {RuleSet IUT = new RuleSet();Random rand = new Random();int numRules = rand.nextInt( 10 ) + 1;Set ruleViolations = new HashSet();for (int i = 0; i < numRules; i++) {    MockRule rule = new MockRule();    RuleViolation violation = new RuleViolation( rule, i, "filename");    ruleViolations.add( violation );    rule.addViolation( violation );    IUT.addRule( rule );}verifyRuleSet( IUT, numRules, ruleViolations );    }    protected void verifyRuleSet( RuleSet IUT,   int size,  Set values )throws Throwable    {RuleContext context = new RuleContext();Set reportedValues = new HashSet();context.setReport( new Report() );IUT.apply( makeCompilationUnits(),   context );assertEquals("Invalid number of Violations Reported",     size, context.getReport().size() );Iterator violations =    context.getReport().iterator();while (violations.hasNext()) {    RuleViolation violation =(RuleViolation) violations.next();    reportedValues.add( violation );    assertTrue( "Unexpected Violation Returned: " + violation,values.contains( violation ) );}Iterator expected = values.iterator();while (expected.hasNext()) {    RuleViolation violation =(RuleViolation) expected.next();    assertTrue( "Expected Violation not Returned: " +violation,reportedValues.contains( violation ));}        }        protected List makeCompilationUnits()throws Throwable    {List RC = new ArrayList();JavaParser parser = new JavaParser( new StringReader( javaCode ));RC.add( parser.CompilationUnit() );return RC;    }}
/* * User: tom * Date: Jun 14, 2002 * Time: 1:18:30 PM */package test.net.sourceforge.pmd;import junit.framework.TestCase;import net.sourceforge.pmd.renderers.Renderer;import net.sourceforge.pmd.renderers.XMLRenderer;import net.sourceforge.pmd.RuleViolation;import net.sourceforge.pmd.Rule;import net.sourceforge.pmd.Report;import java.lang.reflect.Proxy;import java.lang.reflect.InvocationHandler;import java.lang.reflect.Method;public class ReportTest extends TestCase {    public ReportTest(String name) {        super(name);    }    public void testBasic() {        Report r = new Report();        r.addRuleViolation(new RuleViolation(new MockRule(), 5, "foo"));        assertTrue(!r.isEmpty());    }    // Files are grouped together now.    public void testSortedReport_File() {        Report r = new Report();        r.addRuleViolation(new RuleViolation(new MockRule(), 10, "foo"));        r.addRuleViolation(new RuleViolation(new MockRule(), 20, "bar"));        Renderer rend = new XMLRenderer();        String result = rend.render(r);        assertTrue(result.indexOf("bar") < result.indexOf("foo"));    }    public void testSortedReport_Line() {        Report r = new Report();        r.addRuleViolation(new RuleViolation(new MockRule("rule2", "rule2"),      10, "foo"));        r.addRuleViolation(new RuleViolation(new MockRule("rule1", "rule1"),      20, "foo"));        Renderer rend = new XMLRenderer();        String result = rend.render(r);        assertTrue(result.indexOf("rule2") < result.indexOf("rule1"));    }/*    public void testRenderXML() {        Renderer r = new Renderer("xml");        r.addRuleViolation(new RuleViolation(new MockRule(), 5, "foo"));        String rpt = r.render();        assertTrue(rpt.indexOf("foo") != -1);        assertTrue(rpt.indexOf("<pmd>") != -1);        assertTrue(rpt.indexOf("<file>") != -1);    }    public void testRenderHTML() {        Renderer r = new Renderer("html", "format");        r.addRuleViolation(new RuleViolation(new MockRule(), 5, "filename"));        String rpt = r.render();        assertTrue(rpt.indexOf("format") != -1);        assertTrue(rpt.indexOf("<table>") != -1);        assertTrue(rpt.indexOf("filename") != -1);    }*/}
/* * User: tom * Date: Jun 21, 2002 * Time: 2:21:44 PM */package test.net.sourceforge.pmd;import junit.framework.TestCase;import net.sourceforge.pmd.Namespace;import net.sourceforge.pmd.SymbolTable;public class NamespaceTest extends TestCase{    public NamespaceTest(String name) {        super(name);    }    public void testBasic() {        Namespace nameSpace = new Namespace();        nameSpace.addTable();        assertEquals(1, nameSpace.size());        nameSpace.removeTable();        assertEquals(0, nameSpace.size());    }    public void testParent() {        Namespace nameSpace = new Namespace();        nameSpace.addTable();        SymbolTable parent = nameSpace.peek();        nameSpace.addTable();        assertEquals(parent, nameSpace.peek().getParent());    }}
/* * User: tom * Date: Jun 19, 2002 * Time: 11:59:24 AM */package test.net.sourceforge.pmd;import junit.framework.TestCase;import net.sourceforge.pmd.Symbol;public class SymbolTest extends TestCase {    public SymbolTest(String name) {        super(name);    }    public void testBasic() {        Symbol s = new Symbol("foo", 10);        assertEquals(10, s.getLine());        assertEquals("foo", s.getImage());        assertEquals(s, new Symbol("foo", 5));        assertEquals(s.hashCode(), new Symbol("foo", 6).hashCode());    }}
/* * User: tom * Date: Jul 1, 2002 * Time: 2:18:51 PM */package test.net.sourceforge.pmd;import junit.framework.TestCase;import net.sourceforge.pmd.RuleSet;import net.sourceforge.pmd.RuleSetFactory;import net.sourceforge.pmd.Rule;import java.io.StringReader;import java.io.ByteArrayInputStream;import java.util.Iterator;import java.util.Set;import java.util.HashSet;public class RuleSetFactoryTest  extends TestCase {    private static final String EMPTY_RULE_SET = "<?xml version=\"1.0\"?><ruleset name=\"test\"></ruleset>";    private static final String SINGLE_RULE_SET = "<?xml version=\"1.0\"?>" +                         "<ruleset name=\"test\">" +                         "<rule name=\"MockRuleName\" message=\"avoid the mock rule\" class=\"test.net.sourceforge.pmd.MockRule\">" +                         "</rule></ruleset>";    private static final String MULTIPLE_RULE_SET = "<?xml version=\"1.0\"?>" +                         "<ruleset name=\"test\">" +                         "<rule name=\"MockRuleName1\" message=\"avoid the mock rule\" class=\"test.net.sourceforge.pmd.MockRule\"></rule>" +                         "<rule name=\"MockRuleName2\" message=\"avoid the mock rule\" class=\"test.net.sourceforge.pmd.MockRule\"></rule>" +                         "</ruleset>";    private static final String EXTERNAL_REFERENCE_RULE_SET = "<?xml version=\"1.0\"?>" +                         "<ruleset name=\"test\"><rule ref=\"rulesets/basic.xml/EmptyCatchBlock\"/></ruleset>";    public RuleSetFactoryTest(String name) {        super(name);    }    public void testCreateEmptyRuleSet() {        RuleSetFactory rsf = new RuleSetFactory();        RuleSet rs = rsf.createRuleSet(new ByteArrayInputStream(EMPTY_RULE_SET.getBytes()));        assertEquals("test", rs.getName());        assertEquals(0, rs.size());    }/*    public void testExternalReferences() {        RuleSetFactory rsf = new RuleSetFactory();        RuleSet rs = rsf.createRuleSet(new ByteArrayInputStream(EXTERNAL_REFERENCE_RULE_SET.getBytes()));        assertEquals(1, rs.size());    }*/    public void testCreateSingleRuleSet() {        RuleSetFactory rsf = new RuleSetFactory();        RuleSet rs = rsf.createRuleSet(new ByteArrayInputStream(SINGLE_RULE_SET.getBytes()));        assertEquals("test", rs.getName());        assertEquals(1, rs.size());        Iterator i = rs.getRules().iterator();        Object o = i.next();        assertTrue(o instanceof MockRule);        assertTrue(!i.hasNext());        Rule r = (Rule)o;        assertEquals("MockRuleName", r.getName());        assertEquals("avoid the mock rule", r.getMessage());    }    public void testCreateMultipleRuleSet() {        RuleSetFactory rsf = new RuleSetFactory();        RuleSet rs = rsf.createRuleSet(new ByteArrayInputStream(MULTIPLE_RULE_SET.getBytes()));        assertEquals("test", rs.getName());        assertEquals(2, rs.size());        Set expected = new HashSet();        expected.add("MockRuleName1");        expected.add("MockRuleName2");        for (Iterator i = rs.getRules().iterator(); i.hasNext();) {            Rule rule = (Rule)i.next();            assertTrue(expected.contains(rule.getName()));        }    }}
/* * User: tom * Date: Jun 26, 2002 * Time: 4:30:42 PM */package test.net.sourceforge.pmd;import junit.framework.TestCase;import net.sourceforge.pmd.RuleContext;import net.sourceforge.pmd.Report;import net.sourceforge.pmd.renderers.Renderer;public class RuleContextTest extends TestCase {    public RuleContextTest(String name) {        super(name);    }    public void testReport() {        RuleContext ctx = new RuleContext();        assertNull(ctx.getReport());        Report r = new Report();        ctx.setReport(r);        Report r2 = ctx.getReport();        assertEquals(r, r2);    }    public void testFilename() {        RuleContext ctx = new RuleContext();        assertNull(ctx.getSourceCodeFilename());        ctx.setSourceCodeFilename("foo");        assertEquals("foo", ctx.getSourceCodeFilename());    }}
package test.net.sourceforge.pmd;import junit.framework.*;import java.util.*;import net.sourceforge.pmd.Rule;import net.sourceforge.pmd.RuleViolation;public class RuleViolationTest extends TestCase {    public RuleViolationTest(String name) {        super(name);    }    public void testConstructor1() {        Rule rule = new MockRule("name", "desc");        RuleViolation r = new RuleViolation(rule, 2, "filename");        assertEquals(rule, r.getRule());        assertEquals(2, r.getLine());        assertEquals("filename", r.getFilename());    }    public void testConstructor2() {        Rule rule = new MockRule("name", "desc");        RuleViolation r = new RuleViolation(rule, 2, "description", "filename");        assertEquals(rule, r.getRule());        assertEquals(2, r.getLine());        assertEquals("filename", r.getFilename());        assertEquals("description", r.getDescription());    }    //    // Changed logic of Comparator so that rules in the same file    // get grouped together in the output report.    // DDP 7/11/2002    //    public void testComparatorWithDifferentFilenames() {        Rule rule = new MockRule("name", "desc");        RuleViolation.RuleViolationComparator comp = new RuleViolation.RuleViolationComparator();        RuleViolation r1 = new RuleViolation(rule, 10, "description", "filename1");        RuleViolation r2 = new RuleViolation(rule, 20, "description", "filename2");        assertEquals(-1, comp.compare(r1, r2));        assertEquals(1, comp.compare(r2, r1));    }    public void testComparatorWithSameFileDifferentLines() {        Rule rule = new MockRule("name", "desc");        RuleViolation.RuleViolationComparator comp = new RuleViolation.RuleViolationComparator();        RuleViolation r1 = new RuleViolation(rule, 10, "description", "filename");        RuleViolation r2 = new RuleViolation(rule, 20, "description", "filename");        assertTrue(comp.compare(r1, r2) < 0);        assertTrue(comp.compare(r2, r1) > 0);    }    public void testComparatorWithSameFileSameLines() {        Rule rule = new MockRule("name", "desc");        RuleViolation.RuleViolationComparator comp = new RuleViolation.RuleViolationComparator();        RuleViolation r1 = new RuleViolation(rule, 10, "description", "filename");        RuleViolation r2 = new RuleViolation(rule, 10, "description", "filename");        assertEquals(0, comp.compare(r1, r2));        assertEquals(0, comp.compare(r2, r1));    }}
package net.sourceforge.pmd.ast;import java.io.*;public class Test implements JavaParserVisitor{    public static void main(String[] args) {        try {            FileReader fr = new FileReader(new File("c:\\data\\pmd\\pmd\\test-data\\ContainsSystemGetProps.java"));            JavaParser parser = new JavaParser(fr);            Test test = new Test();            ASTCompilationUnit c = parser.CompilationUnit();            c.dump("");            c.childrenAccept(test, null);        } catch (Exception e) {            e.printStackTrace();        }    }    public Object visit(ASTAssertStatement node, Object data){node.childrenAccept(this, data);return null;}    public Object visit(ASTName node, Object data){node.childrenAccept(this, data);return null;}    public Object visit(ASTLocalVariableDeclaration node, Object data){node.childrenAccept(this, data);return null;}    public Object visit(ASTPrimitiveType node, Object data){node.childrenAccept(this, data);return null;}    public Object visit(ASTImportDeclaration node, Object data){node.childrenAccept(this, data);return null;}    public Object visit(ASTLiteral node, Object data){node.childrenAccept(this, data);return null;}  public Object visit(SimpleNode node, Object data) {node.childrenAccept(this, data);return null;}  public Object visit(ASTCompilationUnit node, Object data){node.childrenAccept(this, data);return null;}  public Object visit(ASTPackageDeclaration node, Object data){node.childrenAccept(this, data);return null;}  public Object visit(ASTTypeDeclaration node, Object data){node.childrenAccept(this, data);return null;}  public Object visit(ASTClassDeclaration node, Object data){node.childrenAccept(this, data);return null;}  public Object visit(ASTUnmodifiedClassDeclaration node, Object data){node.childrenAccept(this, data);return null;}  public Object visit(ASTClassBody node, Object data){node.childrenAccept(this, data);return null;}  public Object visit(ASTNestedClassDeclaration node, Object data){node.childrenAccept(this, data);return null;}  public Object visit(ASTClassBodyDeclaration node, Object data){node.childrenAccept(this, data);return null;}  public Object visit(ASTMethodDeclarationLookahead node, Object data){node.childrenAccept(this, data);return null;}  public Object visit(ASTInterfaceDeclaration node, Object data){node.childrenAccept(this, data);return null;}  public Object visit(ASTNestedInterfaceDeclaration node, Object data){node.childrenAccept(this, data);return null;}  public Object visit(ASTUnmodifiedInterfaceDeclaration node, Object data){node.childrenAccept(this, data);return null;}  public Object visit(ASTInterfaceMemberDeclaration node, Object data){node.childrenAccept(this, data);return null;}  public Object visit(ASTFieldDeclaration node, Object data){node.childrenAccept(this, data);return null;}  public Object visit(ASTVariableDeclarator node, Object data){node.childrenAccept(this, data);return null;}  public Object visit(ASTVariableDeclaratorId node, Object data){node.childrenAccept(this, data);return null;}  public Object visit(ASTVariableInitializer node, Object data){node.childrenAccept(this, data);return null;}  public Object visit(ASTArrayInitializer node, Object data){node.childrenAccept(this, data);return null;}  public Object visit(ASTMethodDeclaration node, Object data){node.childrenAccept(this, data);return null;}  public Object visit(ASTMethodDeclarator node, Object data){node.childrenAccept(this, data);return null;}  public Object visit(ASTFormalParameters node, Object data){node.childrenAccept(this, data);return null;}  public Object visit(ASTFormalParameter node, Object data){node.childrenAccept(this, data);return null;}  public Object visit(ASTConstructorDeclaration node, Object data){node.childrenAccept(this, data);return null;}  public Object visit(ASTExplicitConstructorInvocation node, Object data){node.childrenAccept(this, data);return null;}  public Object visit(ASTInitializer node, Object data){node.childrenAccept(this, data);return null;}  public Object visit(ASTType node, Object data){node.childrenAccept(this, data);return null;}  public Object visit(ASTResultType node, Object data){node.childrenAccept(this, data);return null;}  public Object visit(ASTNameList node, Object data){node.childrenAccept(this, data);return null;}  public Object visit(ASTExpression node, Object data){node.childrenAccept(this, data);return null;}  public Object visit(ASTAssignmentOperator node, Object data){node.childrenAccept(this, data);return null;}  public Object visit(ASTConditionalExpression node, Object data){node.childrenAccept(this, data);return null;}  public Object visit(ASTConditionalOrExpression node, Object data){node.childrenAccept(this, data);return null;}  public Object visit(ASTConditionalAndExpression node, Object data){node.childrenAccept(this, data);return null;}  public Object visit(ASTInclusiveOrExpression node, Object data){node.childrenAccept(this, data);return null;}  public Object visit(ASTExclusiveOrExpression node, Object data){node.childrenAccept(this, data);return null;}  public Object visit(ASTAndExpression node, Object data){node.childrenAccept(this, data);return null;}  public Object visit(ASTEqualityExpression node, Object data){node.childrenAccept(this, data);return null;}  public Object visit(ASTInstanceOfExpression node, Object data){node.childrenAccept(this, data);return null;}  public Object visit(ASTRelationalExpression node, Object data){node.childrenAccept(this, data);return null;}  public Object visit(ASTShiftExpression node, Object data){node.childrenAccept(this, data);return null;}  public Object visit(ASTAdditiveExpression node, Object data){node.childrenAccept(this, data);return null;}  public Object visit(ASTMultiplicativeExpression node, Object data){node.childrenAccept(this, data);return null;}  public Object visit(ASTUnaryExpression node, Object data){node.childrenAccept(this, data);return null;}  public Object visit(ASTPreIncrementExpression node, Object data){node.childrenAccept(this, data);return null;}  public Object visit(ASTPreDecrementExpression node, Object data){node.childrenAccept(this, data);return null;}  public Object visit(ASTUnaryExpressionNotPlusMinus node, Object data){node.childrenAccept(this, data);return null;}  public Object visit(ASTCastLookahead node, Object data){node.childrenAccept(this, data);return null;}  public Object visit(ASTPostfixExpression node, Object data){node.childrenAccept(this, data);return null;}  public Object visit(ASTCastExpression node, Object data){node.childrenAccept(this, data);return null;}  public Object visit(ASTPrimaryExpression node, Object data){node.childrenAccept(this, data);return null;}  public Object visit(ASTPrimaryPrefix node, Object data){node.childrenAccept(this, data);return null;}  public Object visit(ASTPrimarySuffix node, Object data){node.childrenAccept(this, data);return null;}  public Object visit(ASTBooleanLiteral node, Object data){node.childrenAccept(this, data);return null;}  public Object visit(ASTNullLiteral node, Object data){node.childrenAccept(this, data);return null;}  public Object visit(ASTArguments node, Object data){node.childrenAccept(this, data);return null;}  public Object visit(ASTArgumentList node, Object data){node.childrenAccept(this, data);return null;}  public Object visit(ASTAllocationExpression node, Object data){node.childrenAccept(this, data);return null;}  public Object visit(ASTArrayDimsAndInits node, Object data){node.childrenAccept(this, data);return null;}  public Object visit(ASTStatement node, Object data){node.childrenAccept(this, data);return null;}  public Object visit(ASTLabeledStatement node, Object data){node.childrenAccept(this, data);return null;}  public Object visit(ASTBlock node, Object data){node.childrenAccept(this, data);return null;}  public Object visit(ASTBlockStatement node, Object data){node.childrenAccept(this, data);return null;}  public Object visit(ASTEmptyStatement node, Object data){node.childrenAccept(this, data);return null;}  public Object visit(ASTStatementExpression node, Object data){node.childrenAccept(this, data);return null;}  public Object visit(ASTSwitchStatement node, Object data){node.childrenAccept(this, data);return null;}  public Object visit(ASTSwitchLabel node, Object data){node.childrenAccept(this, data);return null;}  public Object visit(ASTIfStatement node, Object data){node.childrenAccept(this, data);return null;}  public Object visit(ASTWhileStatement node, Object data){node.childrenAccept(this, data);return null;}  public Object visit(ASTDoStatement node, Object data){node.childrenAccept(this, data);return null;}  public Object visit(ASTForStatement node, Object data){node.childrenAccept(this, data);return null;}  public Object visit(ASTForInit node, Object data){node.childrenAccept(this, data);return null;}  public Object visit(ASTStatementExpressionList node, Object data){node.childrenAccept(this, data);return null;}  public Object visit(ASTForUpdate node, Object data){node.childrenAccept(this, data);return null;}  public Object visit(ASTBreakStatement node, Object data){node.childrenAccept(this, data);return null;}  public Object visit(ASTContinueStatement node, Object data){node.childrenAccept(this, data);return null;}  public Object visit(ASTReturnStatement node, Object data){node.childrenAccept(this, data);return null;}  public Object visit(ASTThrowStatement node, Object data){node.childrenAccept(this, data);return null;}  public Object visit(ASTSynchronizedStatement node, Object data){node.childrenAccept(this, data);return null;}  public Object visit(ASTTryStatement node, Object data){node.childrenAccept(this, data);return null;}}